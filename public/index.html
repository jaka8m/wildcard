// ... (bagian kode lainnya)

async function loadSubdomains() {
    showNotification('Loading subdomains...', 'success');
    try {
        const response = await fetch(`${BASE_API_URL}/subdomains`);
        if (!response.ok) {
            // Coba parsing JSON, tapi jika gagal, ambil sebagai teks
            let errorData;
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                errorData = await response.json();
            } else {
                errorData = { message: await response.text() }; // Ambil sebagai teks jika bukan JSON
            }
            throw new Error(errorData.message || 'Failed to load subdomains. Server returned non-JSON response.');
        }
        const data = await response.json();

        if (data.success) {
            allSubdomains = data.subdomains;
            showNotification('Subdomains loaded successfully!', 'success');
        } else {
            showNotification(data.message || 'Failed to load subdomains.', 'error');
        }
    } catch (error) {
        console.error('Error fetching subdomains from backend:', error);
        // Tampilkan pesan error yang lebih informatif jika respons adalah HTML
        if (error.message.startsWith("Unexpected token 'T', \"The page c\"")) {
            showNotification('Error: The server returned an unexpected response format. Please check the server logs.', 'error');
        } else {
            showNotification(`Error: ${error.message}`, 'error');
        }
        allSubdomains = [];
    } finally {
        applyFiltersAndRender();
    }
}

// ... (bagian kode lainnya)

confirmDeleteBtn.addEventListener('click', async () => {
    const password = deletePasswordInput.value;
    if (!currentDomainToDelete) {
        showNotification('No domain selected for deletion.', 'error');
        confirmDeletionModal.classList.add('hidden');
        return;
    }
    if (password === '') {
        showNotification('Password cannot be empty.', 'error');
        return;
    }

    showNotification('Deleting subdomain...', 'success');
    try {
        const response = await fetch(`${BASE_API_URL}/subdomains/${currentDomainToDelete.id}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ password }),
        });

        // Sama seperti di loadSubdomains, tambahkan penanganan untuk non-JSON response
        let result;
        const contentType = response.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
            result = await response.json();
        } else {
            result = { success: false, message: await response.text() }; // Ambil sebagai teks
        }

        if (!response.ok) {
            throw new Error(result.message || 'Failed to delete subdomain due to server error.');
        }
        
        if (result.success) {
            showNotification('Subdomain deleted successfully!', 'success');
            confirmDeletionModal.classList.add('hidden');
            loadSubdomains();
        } else {
            showNotification(result.message || 'Failed to delete subdomain.', 'error');
            if (result.message !== 'Incorrect password.') {
                confirmDeletionModal.classList.add('hidden');
            }
        }
    } catch (error) {
        console.error('Error deleting subdomain via backend:', error);
        // Tampilkan pesan error yang lebih informatif
        if (error.message.startsWith("Unexpected token 'T', \"The page c\"")) {
            showNotification('Error deleting: The server returned an unexpected response format. Check server logs.', 'error');
        } else {
            showNotification(`Error: ${error.message}`, 'error');
        }
        confirmDeletionModal.classList.add('hidden');
    } finally {
        currentDomainToDelete = null;
        deletePasswordInput.value = '';
    }
});
